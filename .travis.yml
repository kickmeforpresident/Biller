language: csharp
mono: none
sudo: required
dist: xenial
dotnet: 2.2

branches:
  only:
    - master

env:
  global:
    - ASPNETCORE_CONNECTION=$ASPNETCORE_CONNECTION

services:
  - docker

before_install:
  # install heroku CLI
  - wget -qO- https://toolbelt.heroku.com/install.sh | sh
  # login to heroku
  - (echo "$HEROKU_CREDENTIALS_EMAIL" echo "$HEROKU_CREDENTIALS_PASSWORD") | heroku login

script:
  - docker-compose build
  - docker tag web registry.heroku.com/$HEROKU_APP_NAME/web
  - docker push registry.heroku.com/$HEROKU_APP_NAME/web
  - heroku container:release web -a $HEROKU_APP_NAME
